!function(){"use strict";class t{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(t=>this.onNewGameClick(t))),this.saveGameEl.addEventListener("click",(t=>this.onSaveGameClick(t))),this.loadGameEl.addEventListener("click",(t=>this.onLoadGameClick(t))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const h=document.createElement("div");h.classList.add("cell","map-tile","map-tile-"+(i=t,s=this.boardSize,0===i?"top-left":i===s-1?"top-right":i===s*s-s?"bottom-left":i===s*s-1?"bottom-right":Number.isInteger((s*s-i)/s)?"left":Number.isInteger((s*s-i-1)/s)?"right":i>0&&i<s?"top":i>s*s-s?"bottom":"center")),h.addEventListener("mouseenter",(t=>this.onCellEnter(t))),h.addEventListener("mouseleave",(t=>this.onCellLeave(t))),h.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(h)}var i,s;this.cells=Array.from(this.boardEl.children)}redrawPositions(t){for(const t of this.cells)t.innerHTML="";for(const s of t){const t=this.boardEl.children[s.position],h=document.createElement("div");h.classList.add("character",s.character.type);const d=document.createElement("div");d.classList.add("health-level");const f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-"+((i=s.character.health)<15?"critical":i<50?"normal":"high")),f.style.width=`${s.character.health}%`,d.appendChild(f),h.appendChild(d),t.appendChild(h)}var i}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}addNewGameListener(t){this.newGameListeners.push(t)}addSaveGameListener(t){this.saveGameListeners.push(t)}addLoadGameListener(t){this.loadGameListeners.push(t)}onCellEnter(t){t.preventDefault();const i=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,i)))}onCellLeave(t){t.preventDefault();const i=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,i)))}onCellClick(t){t.preventDefault();const i=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,i)))}onNewGameClick(t){t.preventDefault(),this.newGameListeners.forEach((t=>t.call(null)))}onSaveGameClick(t){t.preventDefault(),this.saveGameListeners.forEach((t=>t.call(null)))}onLoadGameClick(t){t.preventDefault(),this.loadGameListeners.forEach((t=>t.call(null)))}static showError(t){alert(t)}static showMessage(t){alert(t)}selectCell(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${i}`)}deselectCell(t){const i=this.cells[t];i.classList.remove(...Array.from(i.classList).filter((t=>t.startsWith("selected"))))}showCellTooltip(t,i){this.cells[i].title=t}hideCellTooltip(t){this.cells[t].title=""}showDamage(t,i){return new Promise((s=>{const h=this.cells[t],d=document.createElement("span");d.textContent=i,d.classList.add("damage"),h.appendChild(d),d.addEventListener("animationend",(()=>{h.removeChild(d),s()}))}))}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}class i{constructor(t){this.storage=t}save(t){this.storage.setItem("state",JSON.stringify(t))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}class s{constructor(t){this.characters=t,this.activePlayer=null,this.areaOfMovement=null,this.attackRadius=null,this.fd=[[0,1,2,3,4,5,6,7],[8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23],[24,25,26,27,28,29,30,31],[32,33,34,35,36,37,38,39],[40,41,42,43,44,45,46,47],[48,49,50,51,52,53,54,55],[56,57,58,59,60,61,62,63]]}findHero(t){return this.characters.find((i=>i.position===t))}activateHero(t){return this.activePlayer=this.findHero(t),this.activePlayer.character.areaOfMovement=this.calculationAreaOfMovement(this.activePlayer),this.activePlayer.character.attackRadius=this.calculationAttackRadius(this.activePlayer),this.activePlayer}calculationAreaOfMovement(t){let i,s=0;return this.fd.forEach((h=>{h.includes(t.position)&&(i=h.findIndex((i=>i===t.position)),s=this.fd.findIndex((t=>t===h)),"magician"===t.character.type&&(this.areaOfMovement=0===s?[this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1]]:[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]),"bowman"===t.character.type&&(this.areaOfMovement=0===s?[this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:1===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:6===s?[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2]]:[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]),"swordsman"===t.character.type&&(0===s?this.areaOfMovement=[this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:1===s?this.areaOfMovement=[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:2===s?this.areaOfMovement=[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:3===s?this.areaOfMovement=[this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:4===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3]]:5===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:6===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s&&(this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4]])))})),this.areaOfMovement}calculationAttackRadius(t){let i,s=0;return this.fd.forEach((h=>{h.includes(t.position)&&(i=h.findIndex((i=>i===t.position)),s=this.fd.findIndex((t=>t===h)),"swordsman"===t.character.type&&(this.attackRadius=0===s?[this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1]]:[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]),"bowman"===t.character.type&&(this.attackRadius=0===s?[this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]:1===s?[this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]:6===s?[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2]]:7===s?[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2]]:[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]),"magician"===t.character.type&&(0===s?this.attackRadius=[this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:1===s?this.attackRadius=[this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:2===s?this.attackRadius=[this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:3===s?this.attackRadius=[this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:4===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4]]:5===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4]]:6===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4]]:7===s&&(this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4]])))})),this.attackRadius}}class h{constructor(t){this.characters=t,this.activeComputer=null,this.enemies=null,this.areaOfMovement=null,this.attackRadius=null,this.fd=[[0,1,2,3,4,5,6,7],[8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23],[24,25,26,27,28,29,30,31],[32,33,34,35,36,37,38,39],[40,41,42,43,44,45,46,47],[48,49,50,51,52,53,54,55],[56,57,58,59,60,61,62,63]]}findVillain(){return this.characters.find((t=>t.character.health>0))}activateComputer(){return this.activeComputer=this.findVillain(),this.activeComputer.character.areaOfMovement=this.calculationAreaOfMovement(this.activeComputer),this.activeComputer.character.attackRadius=this.calculationAttackRadius(this.activeComputer),this.activeComputer}findEnemy(t){return t.find((t=>this.activeComputer.character.attackRadius.includes(t.position)))}randomMove(t){const i=[];t.forEach((t=>i.push(t.position))),this.characters.forEach((t=>i.push(t.position)));const s=this.activeComputer.character.areaOfMovement.filter(Number).filter((t=>!i.includes(t)));return s[Math.floor(Math.random()*s.length)]}calculationAreaOfMovement(t){let i,s=0;return this.fd.forEach((h=>{h.includes(t.position)&&(i=h.findIndex((i=>i===t.position)),s=this.fd.findIndex((t=>t===h)),"daemon"===t.character.type&&(this.areaOfMovement=0===s?[this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1]]:[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]),"vampire"===t.character.type&&(this.areaOfMovement=0===s?[this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:1===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:6===s?[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2]]:[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]),"undead"===t.character.type&&(0===s?this.areaOfMovement=[this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:1===s?this.areaOfMovement=[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:2===s?this.areaOfMovement=[this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:3===s?this.areaOfMovement=[this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3],this.fd[s+4][i-4],this.fd[s+4][i],this.fd[s+4][i+4]]:4===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2],this.fd[s+3][i-3],this.fd[s+3][i],this.fd[s+3][i+3]]:5===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+2][i-2],this.fd[s+2][i],this.fd[s+2][i+2]]:6===s?this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s&&(this.areaOfMovement=[this.fd[s-4][i-4],this.fd[s-4][i],this.fd[s-4][i+4],this.fd[s-3][i-3],this.fd[s-3][i],this.fd[s-3][i+3],this.fd[s-2][i-2],this.fd[s-2][i],this.fd[s-2][i+2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4]])))})),this.areaOfMovement}calculationAttackRadius(t){let i,s=0;return this.fd.forEach((h=>{h.includes(t.position)&&(i=h.findIndex((i=>i===t.position)),s=this.fd.findIndex((t=>t===h)),"undead"===t.character.type&&(this.attackRadius=0===s?[this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]:7===s?[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1]]:[this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s][i-1],this.fd[s][i+1],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1]]),"vampire"===t.character.type&&(this.attackRadius=0===s?[this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]:1===s?[this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]:6===s?[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2]]:7===s?[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2]]:[this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2]]),"daemon"===t.character.type&&(0===s?this.attackRadius=[this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:1===s?this.attackRadius=[this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:2===s?this.attackRadius=[this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:3===s?this.attackRadius=[this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4],this.fd[s+4][i-4],this.fd[s+4][i-3],this.fd[s+4][i-2],this.fd[s+4][i-1],this.fd[s+4][i],this.fd[s+4][i+1],this.fd[s+4][i+2],this.fd[s+4][i+3],this.fd[s+4][i+4]]:4===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4],this.fd[s+3][i-4],this.fd[s+3][i-3],this.fd[s+3][i-2],this.fd[s+3][i-1],this.fd[s+3][i],this.fd[s+3][i+1],this.fd[s+3][i+2],this.fd[s+3][i+3],this.fd[s+3][i+4]]:5===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4],this.fd[s+2][i-4],this.fd[s+2][i-3],this.fd[s+2][i-2],this.fd[s+2][i-1],this.fd[s+2][i],this.fd[s+2][i+1],this.fd[s+2][i+2],this.fd[s+2][i+3],this.fd[s+2][i+4]]:6===s?this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4],this.fd[s+1][i-4],this.fd[s+1][i-3],this.fd[s+1][i-2],this.fd[s+1][i-1],this.fd[s+1][i],this.fd[s+1][i+1],this.fd[s+1][i+2],this.fd[s+1][i+3],this.fd[s+1][i+4]]:7===s&&(this.attackRadius=[this.fd[s-4][i-4],this.fd[s-4][i-3],this.fd[s-4][i-2],this.fd[s-4][i-1],this.fd[s-4][i],this.fd[s-4][i+1],this.fd[s-4][i+2],this.fd[s-4][i+3],this.fd[s-4][i+4],this.fd[s-3][i-4],this.fd[s-3][i-3],this.fd[s-3][i-2],this.fd[s-3][i-1],this.fd[s-3][i],this.fd[s-3][i+1],this.fd[s-3][i+2],this.fd[s-3][i+3],this.fd[s-3][i+4],this.fd[s-2][i-4],this.fd[s-2][i-3],this.fd[s-2][i-2],this.fd[s-2][i-1],this.fd[s-2][i],this.fd[s-2][i+1],this.fd[s-2][i+2],this.fd[s-2][i+3],this.fd[s-2][i+4],this.fd[s-1][i-4],this.fd[s-1][i-3],this.fd[s-1][i-2],this.fd[s-1][i-1],this.fd[s-1][i],this.fd[s-1][i+1],this.fd[s-1][i+2],this.fd[s-1][i+3],this.fd[s-1][i+4],this.fd[s][i-4],this.fd[s][i-3],this.fd[s][i-2],this.fd[s][i-1],this.fd[s][i+1],this.fd[s][i+2],this.fd[s][i+3],this.fd[s][i+4]])))})),this.attackRadius}}class d{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(new.target===d)throw Error("invalid Character() class used");this.level=t,this.attack=0,this.defence=0,this.health=50,this.type=i,this.areaOfMovement=null,this.attackRadius=null}}class f extends d{constructor(t){super(t,"bowman"),this.attack=25,this.defence=25}}class e extends d{constructor(t){super(t,"daemon"),this.attack=10,this.defence=10}}class a extends d{constructor(t){super(t,"magician"),this.attack=10,this.defence=40}}class r extends d{constructor(t){super(t,"swordsman"),this.attack=40,this.defence=10}}class l extends d{constructor(t){super(t,"undead"),this.attack=40,this.defence=10}}class c extends d{constructor(t){super(t,"vampire"),this.attack=25,this.defence=25}}class n{constructor(t,i){if(!(t instanceof d))throw new Error("character must be instance of Character or its children");if("number"!=typeof i)throw new Error("position must be a number");this.character=t,this.position=i}}class o{constructor(t){this.playerTeam=[],this.computerTeam=[],this.positionedTeam=[],this.position=new Set,t.forEach((t=>{(t instanceof f||t instanceof r||t instanceof a)&&this.playerTeam.push(t),(t instanceof c||t instanceof l||t instanceof e)&&this.computerTeam.push(t)}))}createTeam(){let t,i;0!==this.playerTeam.length?(t=this.playerTeam,i=[0,1,8,9,16,17,24,25,32,33,40,41,48,49,56,57]):(t=this.computerTeam,i=[6,7,14,15,22,23,30,31,38,39,46,47,54,55,62,63]),this.position.clear();for(let t=0;t<=i.length-1;t+=1)this.position.add(i[Math.floor(1+15*Math.random()-1+1)]);let d=0;for(const i of t)this.positionedTeam.push(new n(i,Array.from(this.position)[d])),d+=1;return t===this.playerTeam?new s(this.positionedTeam):t===this.computerTeam?new h(this.positionedTeam):null}}function m(t,i,s){const h=[],d=function*(t,i){let s=0,h=0;for(;;)h=Math.floor(1+Math.random()*t.length-1-1+1),s=Math.floor(1+Math.random()*i-1+1),yield new t[h](s)}(t,i);for(let t=0;t<s;t+=1)h.push(d.next().value);return new o(h)}var u="auto",p="pointer",v="crosshair",y="not-allowed",g={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};class T{constructor(t,i){this.gamePlay=t,this.stateService=i,this.playerTeam=m([f,r,a],4,3).createTeam(),this.computerTeam=m([c,l,e],4,3).createTeam(),this.players=[],this.activePlayer=null,this.heroTarget=null,this.villainTarget=null,this.target=null,this.startThemes="prairie",this.turn="player",this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this),this.onCellClick=this.onCellClick.bind(this),this.onNewGameClick=this.onNewGameClick.bind(this),this.onSaveGameClick=this.onSaveGameClick.bind(this),this.onLoadGameClick=this.onLoadGameClick.bind(this)}init(){this.gamePlay.drawUi(this.startThemes);for(const t of this.playerTeam.characters)this.players.push(t);for(const t of this.computerTeam.characters)this.players.push(t);this.gamePlay.redrawPositions(this.players),this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick),this.gamePlay.addNewGameListener(this.onNewGameClick),this.gamePlay.addSaveGameListener(this.onSaveGameClick),this.gamePlay.addLoadGameListener(this.onLoadGameClick)}onCellClick(t){const i=this.gamePlay.cells.findIndex((t=>t.classList.contains("selected-yellow")));if(this.playerTeam.findHero(t)&&null===this.activePlayer&&(this.activePlayer=this.playerTeam.activateHero(t),this.gamePlay.selectCell(this.activePlayer.position)),i===t&&(this.gamePlay.deselectCell(i),this.activePlayer=null),null!=this.activePlayer&&this.gamePlay.cells[t].classList.contains("selected-green")&&(this.activePlayer.position=t,this.gamePlay.redrawPositions(this.players),this.gamePlay.deselectCell(i),this.activePlayer=null,this.turn="computer"),null!=this.activePlayer&&this.gamePlay.cells[t].classList.contains("selected-red")){this.heroTarget=this.computerTeam.characters.find((i=>i.position===t));const s=Math.max(this.activePlayer.character.attack-this.heroTarget.character.defence,.1*this.activePlayer.character.attack);setTimeout((()=>{this.gamePlay.showDamage(t,s).then((()=>{this.heroTarget.character.health-=s,this.heroTarget.character.health<1&&-1!==this.players.findIndex((t=>t.character.health<1))&&(this.computerTeam.characters.splice(this.computerTeam.characters.findIndex((t=>t.character.health<1)),1),this.players.splice(this.players.findIndex((t=>t.character.health<1)),1),this.heroTarget=null),this.gamePlay.redrawPositions(this.players)}))}),200),this.gamePlay.deselectCell(i),this.turn="computer"}if("computer"===this.turn){if(this.activePlayer=this.computerTeam.activateComputer(this.playerTeam.characters),this.villainTarget=this.computerTeam.findEnemy(this.playerTeam.characters),void 0!==this.villainTarget&&null!==this.villainTarget){const t=Math.max(this.activePlayer.character.attack-this.villainTarget.character.defence,.1*this.activePlayer.character.attack);setTimeout((()=>{this.gamePlay.showDamage(this.villainTarget.position,t).then((()=>{this.villainTarget.character.health-=t,this.villainTarget.character.health<1&&-1!==this.players.findIndex((t=>t.character.health<1))&&(this.playerTeam.characters.splice(this.playerTeam.characters.findIndex((t=>t.character.health<1)),1),this.players.splice(this.players.findIndex((t=>t.character.health<1)),1),this.villainTarget=null),this.gamePlay.redrawPositions(this.players)}))}),300)}else this.activePlayer.position=this.computerTeam.randomMove(this.playerTeam.characters);this.activePlayer=null,this.turn="player"}if(!this.computerTeam.characters[0]){this.levelUp();let t=Object.values(g).findIndex((t=>t===document.querySelector("#game-container").querySelector("[data-id=board]").classList[1]))+1;t>Object.values(g).length-1&&(t=0),this.startThemes=Object.values(g)[t],this.gamePlay.drawUi(this.startThemes),this.computerTeam=m([c,l,e],4,3).createTeam();for(const t of this.computerTeam.characters)this.players.push(t);const i=new Set;for(let t=0;t<=15;t+=1)i.add([0,1,8,9,16,17,24,25,32,33,40,41,48,49,56,57][Math.floor(1+15*Math.random()-1+1)]);this.playerTeam.characters.forEach(((t,s)=>{t.position=Array.from(i)[s]})),this.activePlayer=null,this.turn="player",this.gamePlay.redrawPositions(this.players)}}onCellEnter(t){this.gamePlay.setCursor(u);const i=this.players.find((i=>i.position===t));this.target=this.computerTeam.characters.find((i=>i.position===t)),i&&(this.gamePlay.showCellTooltip(`${T.findShow(i)}`,t),this.gamePlay.setCursor(p)),!i&&null!=this.activePlayer&&this.activePlayer.position!==t&&this.activePlayer.character.areaOfMovement.includes(t)&&(this.gamePlay.selectCell(t,"green"),this.gamePlay.setCursor(p)),this.target&&null!=this.activePlayer&&this.activePlayer.character.attackRadius.includes(t)&&(this.gamePlay.selectCell(t,"red"),this.gamePlay.setCursor(v),this.target=null),null==this.activePlayer||this.activePlayer.character.areaOfMovement.includes(t)||this.activePlayer.character.attackRadius.includes(t)||this.gamePlay.setCursor(y)}onCellLeave(t){this.players.find((i=>i.position===t))&&this.gamePlay.hideCellTooltip(t),this.gamePlay.cells[t].classList.contains("selected-green")&&this.gamePlay.deselectCell(t),this.gamePlay.cells[t].classList.contains("selected-red")&&this.gamePlay.deselectCell(t)}onNewGameClick(){this.gamePlay=new t,this.gamePlay.bindToDOM(document.querySelector("#game-container")),this.stateService=new i(localStorage),this.playerTeam=m([f,r,a],4,3).createTeam(),this.computerTeam=m([c,l,e],4,3).createTeam(),this.players=[],this.activePlayer=null,this.heroTarget=null,this.villainTarget=null,this.target=null,this.startThemes="prairie",this.turn="player",this.init()}onLoadGameClick(){const i=this.stateService.load();this.gamePlay=new t,this.gamePlay.bindToDOM(document.querySelector("#game-container")),this.stateService=i.stateService,this.playerTeam=new s(i.playerTeam.characters),this.computerTeam=new h(i.computerTeam.characters),this.players=[],this.activePlayer=null,this.heroTarget=null,this.villainTarget=null,this.target=null,this.startThemes=i.startThemes,this.turn=i.turn,this.init()}onSaveGameClick(){const t={gamePlay:this.gamePlay,stateService:this.stateService,playerTeam:this.playerTeam,computerTeam:this.computerTeam,startThemes:this.startThemes,turn:this.turn};this.stateService.save(t)}levelUp(){this.playerTeam.characters.forEach((t=>{t.character.level+=1,t.character.health+=80,t.character.health>100&&(t.character.health=100),t.character.attack=Math.max(t.character.attack,t.character.attack*(80+t.character.health)/100)}))}static findShow(t){const{character:i}=t;return`🎖 ${i.level} ⚔ ${i.attack} 🛡 ${i.defence} ❤ ${i.health}`}}const C=new t;C.bindToDOM(document.querySelector("#game-container"));const k=new i(localStorage);new T(C,k).init()}();